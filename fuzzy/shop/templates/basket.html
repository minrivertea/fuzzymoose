{% extends base_template %}
{% load thumbnail %}

{% block pagetitle %}Your basket ({{ basket_quantity }}){% endblock %}

{% block extrajs %}
<script type="text/javascript">
$(document).ready( function() {

    $(".discount #toggle").click( function() {
    	$(".discount form").toggle();
    	$(this).toggle();
    	return false;
    });
    
    $('#cancel').click( function() {
       $('.discount form').toggle();
       $('.discount #toggle').toggle(); 
       return false;
    });

});

</script>
{% endblock %}

{% block extracss %}
<style type="text/css">

.basket-row {
  margin: 0 0 0px 0;
  border-bottom: 1px dashed #fff;
  padding: 10px 0;   
}

.basket-row div:last-child {
  text-align: right;   
}

.basket-row.totals {
  font-weight: bold;   
}

.discount form {
   display: none; 
}

.discount form input[type="text"] {
    float: left;
    margin: 0 10px 0 0;
    padding: 3px 10px;
    width: 250px;
}

#checkout-button {
  float: right;
  margin: 20px 0 0 0;   
}

.discount input[type="submit"] {
  margin: 0 5px 0 0;   
}

</style>
{% endblock %}


{% block content %}

    <div class="pure-g-r">
  	<h1 class="pure-u-1-2">Your basket ({{ basket_quantity }} item{{ basket_quantity|pluralize }})</h1>
  	  	
  	<ul id="steps" class="pure-u-1-2">
		<li>
			<a class="selected" href="{% url 'basket' %}">1. Your basket</a>
		</li>
		<li>
			<a class="" href="{% url 'order_step_one' %}">2. Your details</a>
		</li>
		<li>
			<a href="">3. Confirm and pay</a>
		</li>
	</ul>
	
	</div>

{% if basket_items %}

  <div class="pure-g-r">
	{% for thing in basket_items %}
	  <div class="basket-row {% if thing.item.stocks.preorder %} preorder{% endif %} pure-u-1">
	  
		<div class="pure-u-1-8">
			{% thumbnail thing.price.product.get_main_photo.image product_photo_small crop="center" as im %}
			<img src="{{ im.url }}"/>
			{% endthumbnail %}
			<br/>
		</div>
		<div class="pure-u-1-2">
		  <a title="{{ thing.price.product.short_description }}" href="{{ thing.price.product.get_absolute_url }}">{{ thing.price.product.name }}
		  </a><br/>
		   {{ currency.symbol }}{{ thing.price.price|floatformat:"2" }} 
		      each
	    </div>
        
        <div class="pure-u-1-8">
		  x {{ thing.quantity }}
        </div>
		<div class="pure-u-1-12">
          <div class="updown">
		      <a class="plus" href="{% url 'increase_quantity' thing.id %}"><span>+</span></a>
		      {% ifequal thing.quantity 1 %}{% else %} <a class="minus" href="{% url 'reduce_quantity' thing.id %}"><span>-</span></a>{% endifequal %}
		  </div>
		  <a class="remove" title="Remove from basket" alt="Remove from basket" href="{% url 'remove_from_basket' thing.id %}">Remove</a>
		</div>
	    <div class="pure-u-1-8">
		  {{ currency.symbol }}{{ thing.get_price|floatformat:"2" }}
		</div>
		
	  </div>
	{% endfor %}
	
    {% if shopsettings.postage_price %}
	<div class="basket-row postage pure-u-1">
		<div class="pure-u-1-8">&nbsp;</div>
		
		{% if postage_discount %}
	  	<div class="pure-u-1-2">
	  		<span class="strikethrough name">Postage</span>
        </div>  
        <div class="pure-u-1-8 strikethrough">{{ currency.symbol }}{{ shopsettings.postage_price|floatformat:"2" }}</div>
		{% else %}
		<div class="pure-u-1-2">
			<span class="name">Postage</span>
			<span class="small">Delivered in 1-3 days | Shipped from the UK</span>
		</div>
		<div class="pure-u-1-8">&nbsp;</div>
		<div class="pure-u-1-12">&nbsp;</div>
		<div class="pure-u-1-8">{{ currency.symbol }}{{ shopsettings.postage_price|floatformat:"2" }}</div>
		{% endif %}
	</div>
	{% endif %}
	

	<div class="basket-row discount pure-u-1">
		{% if not discount %}
		<div class="pure-u-1-8">&nbsp;</div>
		<div class="pure-u-2-3">
		  <a href="" id="toggle">Got a discount code?</a>
		  <form action="." method="post">
		      {% csrf_token %}
            <input type="text" name="discount_code" id="id_discount_code" class="clearMeFocus pure-u-1-3" title="Enter discount code here"/>
            <input type="submit" class="button green" value="Apply discount" id="submit"/>
            <a href="" id="cancel" class="button small red">Cancel</a>
		</form>
		</div>
		<div class="pure-u-1-8">&nbsp;</div>
		
		
		{% else %}
		<div class="pure-u-1-8">&nbsp;</div>
		<div class="pure-u-1-2">
		  You have entered a discount code worth {{ percent|floatformat }}% off! <a class="small" href="?clear_discount=true">Clear</a>
		</div>
		<div class="pure-u-1-8">&nbsp;</div>
		<div class="pure-u-1-12">&nbsp;</div>
		<div class="pure-u-1-8">
		  <span class="red">-{{ currency.symbol }}{{ discount_amount|floatformat:"-2" }}</span>
		</div>
		{% if discount_message %}
		  <span id="message" class="red">{{ discount_message }} - </span>
		{% endif %}
		{% endif %}
	</div>
	
	<div class="basket-row totals pure-u-1">
		<div class="pure-u-1-8">&nbsp;</div>
		<div class="pure-u-1-2">
			<span class="name">Total</span>
		</div>
		<div class="pure-u-1-8">&nbsp;</div>
		<div class="pure-u-1-12">&nbsp;</div>
		<div class="pure-u-1-8">
			{{ currency.symbol }}{{ total_price|floatformat:"2" }}
		</div>
	</div>

	<br clear="all"/>
	
	
 	<div id="checkout-button" class="pure-u-1-4">		
    	<a class="button large" href="{% url 'order_step_one' %}">Start checkout now &raquo;</a>
	</div>
	
</div>

{% endif %}
 

{% endblock %}
